"0","## Map prep ----"
"0",""
"0","# read in shapefiles"
"0","  MPAs<-read_sf(r""(R:\Science\CetaceanOPPNoise\CetaceanOPPNoise_2\shapefiles\ProtectedAreas\DFO\OA_MPAs\EastCan_MPAS.shp)"")"
"0",""
"0","  canada <- read_sf(""R:/Science/CetaceanOPPNoise/CetaceanOPPNoise_2/shapefiles/coastline/canada/clipped/canada_simple.shp"") %>% "
"0","    st_transform(4326)"
"0","  "
"0",""
"0","  north.america <- read_sf(""R:/Science/CetaceanOPPNoise/CetaceanOPPNoise_2/shapefiles/coastline/north_america/north_america.shp"") %>% "
"0","    st_transform(4326)"
"0"," "
"0","#read in bathymetry"
"0",""
"0","bf = readRDS(r""(R:\Science\CetaceanOPPNoise\CetaceanOPPNoise_2\bathymetry\baleenwhale\bathymetry.RDS)"")"
"0",""
"0","## Map that ----"
"0","if(params$filterstations){"
"0","  "
"0","stations.for.map <- stations %>% filter(station %in% params$stations)"
"0",""
"0","station.map <-ggplot() +"
"0","  "
"0","  # add bathymetry"
"0","  geom_raster(data=bf, aes(x=x, y=y, fill=z)) +"
"0","  scale_fill_distiller(palette=""Blues"",guide = 'none') +"
"0","  "
"0","  # add land region"
"0","  geom_sf(data = canada, color=NA, fill=""grey60"") +"
"0","  "
"0","  # add MPAs"
"0","  geom_sf(data=MPAs, color= NA, fill=""darkred"", alpha=0.3) +"
"0","  "
"0","  # add stations"
"0","  geom_point(data= stations.for.map, aes(x = lon, y = lat), colour=""black"", fill = ""black"", shape=17, size = 1, stroke = 2)+"
"0","  geom_text(data= stations.for.map, aes(x=lon, y=lat, label = station), nudge_y =  -0.1) +"
"0","  "
"0","  "
"0","  #finish up"
"0","  coord_sf(ylim = c(round(min(stations.for.map$lat)-1,0), round(max(stations.for.map$lat)+1,0)), "
"0","           xlim = c(round(min(stations.for.map$lon)-1,0), round(max(stations.for.map$lon)+1,0)), expand = FALSE) +"
"0","  "
"0","  ylab("""") + "
"0","  xlab("""") +"
"0","  theme(panel.grid.major = element_blank(),"
"0","        panel.grid.minor = element_blank(),"
"0","        strip.background =element_rect(fill=""white"", colour = ""black""),"
"0","        text = element_text(size = 12),"
"0","        legend.key = element_rect(fill = NA),"
"0","        plot.margin = margin(0.3,0.1,0.1,0.1,""cm""),"
"0","        panel.spacing.x = unit(1, ""lines""))"
"0",""
"0","map.full <-ggplot() +"
"0","  "
"0","  # add bathymetry"
"0","  geom_raster(data=bf, aes(x=x, y=y, fill=z)) +"
"0","  scale_fill_distiller(palette=""Blues"",guide = 'none') +"
"0","  "
"0","  # add land region"
"0","  geom_sf(data = canada, color=NA, fill=""grey60"") +"
"0","  "
"0","  # add MPAs"
"0","  geom_sf(data=MPAs, color= NA, fill=""darkred"", alpha=0.3) +"
"0","  "
"0","  #add zoom rectangle"
"0","  geom_rect(aes(xmin = round(min(stations.for.map$lon)-1,0), xmax = round(max(stations.for.map$lon)+1,0), "
"0","                ymin = round(min(stations.for.map$lat)-1,0), ymax = round(max(stations.for.map$lat)+1,0)),"
"0","            color = ""red"", fill = NA)+"
"0","  "
"0","  #finish up"
"0","  coord_sf(xlim = c(-68, -55), ylim = c(39, 47.5), expand = FALSE) +"
"0","  "
"0","  # ylab("""") + "
"0","  xlab("""") +"
"0","  "
"0","  theme_void()+"
"0","  theme(plot.background = element_rect(color = ""black"", size = 2),"
"0","        plot.margin = margin(1, 1, 1, 1, unit = ""pt""),"
"0","        legend.key = element_rect(fill = NA))"
"0",""
"0","station_inset_map <- ggdraw() +"
"0","  draw_plot(station.map) +"
"0","  draw_plot(map.full, x = 0.9, y = 0.15, width = 0.3, height = 0.3)"
"0",""
"0","station_inset_map"
"0","} else {"
"0","  #get stations for mapping"
"0","stations.for.map <- stations %>% "
"0","  select(station, lat, lon) %>% "
"0","  filter(station %in% species.data$station)"
"0",""
"0","ggplot() +"
"0","  "
"0","  # add bathymetry"
"0","  geom_raster(data=bf, aes(x=x, y=y, fill=z)) +"
"0","  scale_fill_distiller(palette=""Blues"",guide = 'none') +"
"0","  "
"0","  # add land region"
"0","  geom_sf(data = canada, color=NA, fill=""grey60"") +"
"0","  "
"0","  # add NARW CH shapefile"
"0","  geom_sf(data=MPAs, color= NA, fill=""darkred"", alpha=0.3) +"
"0","  "
"0","  # add stations"
"0","  geom_point(data= stations.for.map, aes(x = lon, y = lat), colour=""black"", fill = ""black"", shape=17, size = 1, stroke = 2)+"
"0","  geom_text(data= stations.for.map, aes(x=lon, y=lat, label = station), nudge_y =  -0.2) +"
"0","  "
"0","  "
"0","  #finish up"
"0","  coord_sf(xlim = c(-72, -53), ylim = c(40, 48), expand = FALSE) +"
"0","  "
"0","  ylab("""") + "
"0","  xlab("""") +"
"0","  theme(panel.grid.major = element_blank(),"
"0","        panel.grid.minor = element_blank(),"
"0","        strip.background =element_rect(fill=""white"", colour = ""black""),"
"0","        text = element_text(size = 12),"
"0","        legend.key = element_rect(fill = NA),"
"0","        plot.margin = margin(0.3,0.1,0.1,0.1,""cm""),"
"0","        panel.spacing.x = unit(1, ""lines""))"
"0","}"
